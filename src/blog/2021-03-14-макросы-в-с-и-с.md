---
title: Макросы в С и С++
date: 2021-03-14T14:19:52.994Z
---
<!--StartFragment-->

Макросы - один из моих самых любимых инструментов в языках С и С++. Умные люди и умные книжки советуют по максимуму избегать использования макросов, по возможности заменяя их шаблонами, константами и inline-функциями, и на то есть веские основания. С помощью макросов можно создавать не только изящный код, но и плодить не менее изящные баги, которые потом будет очень сложно отловить и пофиксить. Но если соблюдать ряд несложных правил при работе с макросами, они становятся мощным оружием, которое не стреляет по твоим собственным коленям. Но сперва давай разберемся, что вообще такое макросы в С и С++?

### Что есть макросы?

В языках С и С++ есть такой механизм, как *препроцессор*. Он обрабатывает исходный код программы ДО того, как она будет скомпилированна. У перпроцессора есть свои директивы, такие как *\#include, #pragma, #if* и тд. Но нам интересна только директива *\#define*.

В языке Си довольно распространенной практикой является объявление глобальных констант с помощью директивы #define:

А потом, на этапе препроцессинга все использования PI будут заменены указанным значением:

После препроцессинга, который по сути является банальной подстановкой, это выражение превратится в:

PI - макрос, в самом простом его исполнении. Естественно, макросы в таком виде не работают как переменные. Им нельзя присваивать новое значение или использовать их адрес.

О макросах важно понимать, что область видимости у них такая же, как у нестатических функций в языке Си, то есть они видны везде, куда их "заинклюдили". Однако в отличии от функций, объявление макроса можно отменить:

После этой строчки обращаться к PI будет уже нельзя.

### Макросы с параметрами

Самое интересное начинается, когда у макросов появляются параметры. Параметры в макросах работают примерно так же, как аргументы функции. Простой пример - макрос, который определяет больший из переданных ему параметров:

Макрос может состоять не только из одного выражения. Например макрос, который меняет значения двух переменных:

Поскольку мы первым параметром передаем тип, данный макрос будет работать с переменными любого типа:

Макросы так же можно записывать в несколько строк, но тогда каждая строка, кроме последней, должна заканчиваться символом '\':

Таким образом у нас получился аналог шаблонов из С++. Но стоит сразу обратить внимание, что данный способ не подойдет для типов, название которых состоит более чем из одного слова, например long long или unsigned short, потому что не получится нормально склеить название функции (*sum_##type*). Для этого сперва придется объявить для них новый тип, состоящий из одного слова.

Но все же, если есть возможность обходится без макросов, лучше обходится без макросов. Даже если ты прекрасно усвоил, как они работают, и понимаешь их силу, это никак не страхует тебя от того, что ты допустишь какую-то глупую ошибку при объявлении макроса, а потом 20 минут потратишь на ее поиски. Так что не стоит оборачивать в макросы вообще все, что только можно.

<!--StartFragment-->

Долгие годы я был уверен, что в основной массе подобные конфликты, все стороны которого преследуют общие цели, завязаны на нюансы социальной психологии, которые действительно проявляют себя в самых разных аспектах человеческих взаимодействий. Отношение субъектов социальной коммуникации друг к другу без влияния когнитивных факторов возможно в исключительно редких случаях. Честно говоря, при написании этой статьи вспоминаются только эпизоды микро-коммуникаций (small talk), встречавшиеся в повседневной жизни, в которых социальная психология оказывала минимальное влияние на диалоги.

Мешают ли выполнению профессиональных задач проблемы в коммуникации людей друг с другом также, как если бы это была любая другая сфера жизни? Безусловно. В числе заметных факторов, которые формируют когнитивные помехи, можно назвать эффект Даннинга-Крюгера, психологию социальной группы и межличностные отношения, пирамиду Маслоу (точнее, положение субъектов взаимодействия относительно своих потребностей), личный опыт и другие. При этом, многие факторы, такие как здоровье, эмоции, гендер и т.п., находятся дальше от психологии, так как более-менее здоровое общество или социальная группа по умолчанию должны воспитывать в себе понимание, что все люди разные и это нормально. Если общество такие вещи не понимает, то это уже не когнитивное искажение, а просто болезнь. Тем не менее, рассматривая профессиональные взаимодействия, анализируя опыт, любой профессионал сможет вспомнить множество ситуаций, когда, казалось бы, все поведенческие факторы были учтены, но это не помогло. Точнее, произошло то же самое, что и обычно — стороны, которые должны были легко договориться между собой, не договорились, хотя очень этого хотели.

Ключевой тезис, который я сформировал за последние несколько лет профессиональной деятельности, оказываясь за это время в самых разных ролях в самых разных взаимодействиях, звучит так: **сам путь, по которому специалист становится носителем своих компетенций, является наиболее значимым препятствием для разговора на одном языке**.

Если обобщить, поскольку субъективное восприятие всегда отличается от объективной реальности, каждый субъект социальных взаимодействий (а это не обязательно один человек, это может быть и группа людей, и целое общество) видит не то же самое, что оппонент, даже если это единомышленник. Так рождаются споры, дискуссии, диспуты и прочее, что является (ну или должно являться) процессом, при котором стороны приходят к убеждению, что они корректно поняли друг друга. В результате, на мой взгляд, корректно выделить два основных сценария, по которым мы стремимся к взаимопониманию в профессиональной деятельности:

1. Междисциплинарная коммуникация,
2. Кросс-культурная коммуникация.

При этом сам способ общения, методы коммуникации не является фактором, который имеет ключевую роль. Главный фактор — разница восприятия, разница в интерпретации трактовке происходящего.

Например, в русскоязычной культуре есть традиция разделения носителей научно-технических компетенций и носителей творческих компетенций на технарей и гуманитариев, чтобы упростить разницу в восприятии разными людьми одного и того же объекта.

Рисунок 2. Моя любимая визуализация влияния точки зрения на интерпретацию объекта.

Якобы, ничего страшного не произойдет, если решать одну и ту же задачу разными методами — результат будет одинаковый.

Это, конечно же, не работает как минимум на уровне логики. Если предмет отбрасывает на разные стены две разные тени, то из этого не следует, что две разные тени сформируют квадратный круг, хотя он может быть и похож на оригинал с рядом допущений. (Вспоминается карго-культ, например).

Между тем, подобные эпизоды мы часто видим в реальности, и это очень большая проблема, так как различий в способах восприятия одного и того же существует бесконечное множество. Менеджер из Новосибирска, музыкант из Петербурга и архитектор из Воронежа не смогут воспринимать, к примеру, екатеринбургский Ельцин-центр хотя бы приблизительно одинаково. Так с чего же, приступая к переговорам, к сотрудничеству или к работе в команде, мы надеемся, что на одном уровне восприятия окажутся наши партнёры или оппоненты, каждый из которых имеет уникальный жизненный и профессиональный путь? Такие надежды не являются оправданными — переводить свою информацию на уровень восприятия другого человека требуется как с учётом культурного фона, так и с учётом разных компетенций.

Но это хорошо, так как **один из врождённых навыков людей — стремление объединять усилия для решения общих задач**.

Но что же лучше: приводить команды к общему знаменателю по уровню профессионализма или по уровню личностей? Основная идея, которая легла в фундамент статьи: **как правило, искусственное усреднение специалистов, работающих над решением общей задачи, не приносит пользы**.

К сожалению, научить разных людей работать вместе по общим принципам само по себе является непростой задачей. Однако, ряд идей для решения проблем кросс-культурной и междисциплинарной коммуникаций я бы хотел предложить уже в этой публикации.



**Возможность №1**. Баланс компетенций и ценностей

Если вы стремитесь к равновесию при формировании рабочих групп, которые были назначены, а не образовались естественным путём, то избыток компетенций или опыта по одному из направлений следует уравновешивать, исходя из того, что в результате команда должна стать носителем системы ценностей, а не простого набора точек зрения.



**Возможность №2**. Привлечение медиатора

Идеальный лидер команды — носитель и кросс-культурных, и междисциплинарных навыков коммуникации, способный к усилению, а не девальвации системы ценностей в пределах команды.

Однако зачастую лидер (или руководитель) не будет иметь достаточного опыта, чтобы эффективно закрыть потребность команды в модерации внутренних переговоров и конфликтов. В случае необходимости (а как правило такая необходимость есть), информационное посредничество может быть выделено в самостоятельную трудовую функцию.

Разумеется, исполнение обязанностей медиатора может быть реализовано только носителем/носителями метакомпетенций.

**Возможность №3**. Инженерный подход

Или любая другая методология управления, которая позволяет постулировать компетенции и зоны ответственности в единую производственную структуру.

Рисунок 3. Схематичное отображение методологии "Инженерный подход", предлагаемой автором.

Лично я предпочитаю интерпретировать инженерный подход как дефрагментацию исполнительной и управленческой компетенций, однако и другие встречавшиеся мне трактовки также имеют место быть.

В числе управленческих методологий общего назначения, эффективность которых мне удалось зафиксировать, рекомендую обратить внимание на процессный подход (процессное управление), системный подход, кайдзен.



**Возможность №4**. Распределённая иерархия с лидерами компетенций

Большинство людей, принимающих решения, предпочитает поручать реализацию задач командам, которые умеют работать в единой системе ценностей. Как правило, иерархии — это отличный способ сохранения когнитивного единообразия на пути от звена i к любому из звеньев i+j. Однако, как любая система, иерархия стремится к равновесию, что может иметь побочные эффекты. Один из таких эффектов — вероятность девальвации непонятных ценностей (aka см. начало статьи). Для типовой сквозной иерархии это будет означать главенство точки зрения большинства участников.

Решение: распределенная иерархия, когда единообразие ценностей всей группы сочетается с дополнительным разделением зон ответственности по направлению компетенций членов команды. Большие команды складываются из команд поменьше, при этом внутри каждой подгруппы должны быть определены лица, принимающие решения по направлению зоны ответственности.

\
**Возможность №5**. Единое информационное пространство

Банк знаний — это в любой ситуации хорошее решение. Вспомните, с чего начинается становление личности у современного человека? В детстве мы читаем учебники, затем потребляем профильный контент, в конечном итоге, в среднем, определяем свою социальную группу кругом людей, которые читали эти же учебники, смотрели те же фильмы, носили ту же одежду и т.д.

Почему в профессиональной деятельности должно быть иначе? Обратите внимание, профессиональные сообщества с высоким порогом входа (врачи, инженеры, учёные и т.д.) не стесняются специализированных конференций, чтобы обсуждать групповые системы ценностей. Усовершенствование группового восприятия различных аспектов повышает и компетентность отдельных членов группы.

Организации и команды, которые применяют для достижения целей такие вещи, как междисциплинарные или кросс-культурные коммуникации, могут применять те же решения, что и крупные профессиональные сообщества. Как минимум на уровне формулирования системы ценностей и общих банков данных.

**Возможность №6.** Словарь терминов

Строго говоря, глоссарии мы обычно встречаем как части документов со строгой типологией, таких как юридические договоры или научные труды, смысл которых порой напрямую зависит от точности заданных определений. Определение (обсуждение, при необходимости) терминов, которые будут использовать в совместной работе стороны, испытывающие проблемы в коммуникации, — ещё одна очень сильная опция.

Друзья, сформулированная выше проблематика, а также некоторые идеи для её решения, являются попыткой уместить в одну публикацию около 15 лет профессиональной деятельности, которая зачастую требовала простых решений для сложных ситуаций и наоборот. Понимаю, что данный материал скорее обзорный, поэтому рассказы о практических (успешных и не очень) попытках решения управленческих задач с участием непредсказуемых элементов, готов подготовить и опубликовать позже. В зависимости от интереса уважаемого сообщества к теме.



P.s. В заключение призываю не принимать на веру любую информацию (включая и эту статью), не прошедшую критическую проверку на основе опыта, которому лично вы имеете основания доверять. Это является одним из важнейших ключей к тому, чтобы понимать тех, кого вы не понимаете.

<!--EndFragment-->

<!--EndFragment-->